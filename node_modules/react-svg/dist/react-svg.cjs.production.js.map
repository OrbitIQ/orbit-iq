{"version":3,"file":"react-svg.cjs.production.js","sources":["../compiled/owner-window.js","../compiled/shallow-differs.js","../compiled/ReactSVG.js"],"sourcesContent":["// Hat-tip: https://github.com/mui/material-ui/tree/master/packages/mui-utils/src.\nconst ownerWindow = (node) => {\n    const doc = node?.ownerDocument || document;\n    return doc.defaultView || window;\n};\nexport default ownerWindow;\n","// Hat-tip: https://github.com/developit/preact-compat/blob/master/src/index.js#L402.\nconst shallowDiffers = (a, b) => {\n    for (const i in a) {\n        if (!(i in b)) {\n            return true;\n        }\n    }\n    for (const i in b) {\n        if (a[i] !== b[i]) {\n            return true;\n        }\n    }\n    return false;\n};\nexport default shallowDiffers;\n","import { SVGInjector } from '@tanem/svg-injector';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport ownerWindow from './owner-window';\nimport shallowDiffers from './shallow-differs';\nconst svgNamespace = 'http://www.w3.org/2000/svg';\nconst xlinkNamespace = 'http://www.w3.org/1999/xlink';\nexport class ReactSVG extends React.Component {\n    static defaultProps = {\n        afterInjection: () => undefined,\n        beforeInjection: () => undefined,\n        desc: '',\n        evalScripts: 'never',\n        fallback: null,\n        httpRequestWithCredentials: false,\n        loading: null,\n        onError: () => undefined,\n        renumerateIRIElements: true,\n        title: '',\n        useRequestCache: true,\n        wrapper: 'div',\n    };\n    static propTypes = {\n        afterInjection: PropTypes.func,\n        beforeInjection: PropTypes.func,\n        desc: PropTypes.string,\n        evalScripts: PropTypes.oneOf(['always', 'once', 'never']),\n        fallback: PropTypes.oneOfType([\n            PropTypes.func,\n            PropTypes.object,\n            PropTypes.string,\n        ]),\n        httpRequestWithCredentials: PropTypes.bool,\n        loading: PropTypes.oneOfType([\n            PropTypes.func,\n            PropTypes.object,\n            PropTypes.string,\n        ]),\n        onError: PropTypes.func,\n        renumerateIRIElements: PropTypes.bool,\n        src: PropTypes.string.isRequired,\n        title: PropTypes.string,\n        useRequestCache: PropTypes.bool,\n        wrapper: PropTypes.oneOf(['div', 'span', 'svg']),\n    };\n    initialState = {\n        hasError: false,\n        isLoading: true,\n    };\n    state = this.initialState;\n    _isMounted = false;\n    reactWrapper;\n    nonReactWrapper;\n    refCallback = (reactWrapper) => {\n        this.reactWrapper = reactWrapper;\n    };\n    renderSVG() {\n        /* istanbul ignore else */\n        if (this.reactWrapper instanceof ownerWindow(this.reactWrapper).Node) {\n            const { desc, evalScripts, httpRequestWithCredentials, renumerateIRIElements, src, title, useRequestCache, } = this.props;\n            /* eslint-disable @typescript-eslint/no-non-null-assertion */\n            const onError = this.props.onError;\n            const beforeInjection = this.props.beforeInjection;\n            const afterInjection = this.props.afterInjection;\n            const wrapper = this.props.wrapper;\n            let nonReactWrapper;\n            let nonReactTarget;\n            if (wrapper === 'svg') {\n                nonReactWrapper = document.createElementNS(svgNamespace, wrapper);\n                nonReactWrapper.setAttribute('xmlns', svgNamespace);\n                nonReactWrapper.setAttribute('xmlns:xlink', xlinkNamespace);\n                nonReactTarget = document.createElementNS(svgNamespace, wrapper);\n            }\n            else {\n                nonReactWrapper = document.createElement(wrapper);\n                nonReactTarget = document.createElement(wrapper);\n            }\n            nonReactWrapper.appendChild(nonReactTarget);\n            nonReactTarget.dataset.src = src;\n            this.nonReactWrapper = this.reactWrapper.appendChild(nonReactWrapper);\n            const handleError = (error) => {\n                this.removeSVG();\n                if (!this._isMounted) {\n                    onError(error);\n                    return;\n                }\n                this.setState(() => ({\n                    hasError: true,\n                    isLoading: false,\n                }), () => {\n                    onError(error);\n                });\n            };\n            const afterEach = (error, svg) => {\n                if (error) {\n                    handleError(error);\n                    return;\n                }\n                // TODO (Tane): It'd be better to cleanly unsubscribe from SVGInjector\n                // callbacks instead of tracking a property like this.\n                if (this._isMounted) {\n                    this.setState(() => ({\n                        isLoading: false,\n                    }), () => {\n                        try {\n                            afterInjection(svg);\n                        }\n                        catch (afterInjectionError) {\n                            handleError(afterInjectionError);\n                        }\n                    });\n                }\n            };\n            const beforeEach = (svg) => {\n                svg.setAttribute('role', 'img');\n                if (desc) {\n                    const originalDesc = svg.querySelector(':scope > desc');\n                    if (originalDesc) {\n                        svg.removeChild(originalDesc);\n                    }\n                    const newDesc = document.createElement('desc');\n                    newDesc.innerHTML = desc;\n                    svg.prepend(newDesc);\n                }\n                if (title) {\n                    const originalTitle = svg.querySelector(':scope > title');\n                    if (originalTitle) {\n                        svg.removeChild(originalTitle);\n                    }\n                    const newTitle = document.createElement('title');\n                    newTitle.innerHTML = title;\n                    svg.prepend(newTitle);\n                }\n                try {\n                    beforeInjection(svg);\n                }\n                catch (error) {\n                    handleError(error);\n                }\n            };\n            SVGInjector(nonReactTarget, {\n                afterEach,\n                beforeEach,\n                cacheRequests: useRequestCache,\n                evalScripts,\n                httpRequestWithCredentials,\n                renumerateIRIElements,\n            });\n        }\n    }\n    removeSVG() {\n        if (this.nonReactWrapper?.parentNode) {\n            this.nonReactWrapper.parentNode.removeChild(this.nonReactWrapper);\n            this.nonReactWrapper = null;\n        }\n    }\n    componentDidMount() {\n        this._isMounted = true;\n        this.renderSVG();\n    }\n    componentDidUpdate(prevProps) {\n        if (shallowDiffers({ ...prevProps }, this.props)) {\n            this.setState(() => this.initialState, () => {\n                this.removeSVG();\n                this.renderSVG();\n            });\n        }\n    }\n    componentWillUnmount() {\n        this._isMounted = false;\n        this.removeSVG();\n    }\n    render() {\n        /* eslint-disable @typescript-eslint/no-unused-vars */\n        const { afterInjection, beforeInjection, desc, evalScripts, fallback: Fallback, httpRequestWithCredentials, loading: Loading, renumerateIRIElements, src, title, useRequestCache, wrapper, ...rest } = this.props;\n        /* eslint-enable @typescript-eslint/no-unused-vars */\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const Wrapper = wrapper;\n        return (React.createElement(Wrapper, { ...rest, ref: this.refCallback, ...(wrapper === 'svg'\n                ? {\n                    xmlns: svgNamespace,\n                    xmlnsXlink: xlinkNamespace,\n                }\n                : {}) },\n            this.state.isLoading && Loading && React.createElement(Loading, null),\n            this.state.hasError && Fallback && React.createElement(Fallback, null)));\n    }\n}\n"],"names":["ownerWindow","node","ownerDocument","document","defaultView","window","shallowDiffers","a","b","i","svgNamespace","xlinkNamespace","ReactSVG","_React$Component","_this","_len","arguments","length","args","Array","_key","call","apply","this","concat","initialState","hasError","isLoading","state","_isMounted","reactWrapper","nonReactWrapper","refCallback","_inheritsLoose","_proto","prototype","renderSVG","_this2","Node","nonReactTarget","_this$props","props","desc","evalScripts","httpRequestWithCredentials","renumerateIRIElements","src","title","useRequestCache","onError","beforeInjection","afterInjection","wrapper","createElementNS","setAttribute","createElement","appendChild","dataset","handleError","error","removeSVG","setState","SVGInjector","afterEach","svg","afterInjectionError","beforeEach","originalDesc","querySelector","removeChild","newDesc","innerHTML","prepend","originalTitle","newTitle","cacheRequests","_this$nonReactWrapper","parentNode","componentDidMount","componentDidUpdate","prevProps","_this3","_extends","componentWillUnmount","render","_this$props2","Fallback","fallback","Loading","loading","rest","_objectWithoutPropertiesLoose","_excluded","React","ref","xmlns","xmlnsXlink","Component","defaultProps"],"mappings":"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"}